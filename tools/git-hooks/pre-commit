#!/bin/bash
set -e

echo "üîç Running pre-commit checks..."

# 1. Run gofmt
echo "Formatting code with gofmt..."
UNFORMATTED=$(gofmt -l .)
if [ -n "$UNFORMATTED" ]; then
    echo "gofmt failed on:"
    echo "$UNFORMATTED"
    echo "Run: gofmt -w ."
    exit 1
fi

# 2. Fast lint (for quick feedback)
echo "Running golangci-lint."
golangci-lint run
if [ $? -ne 0 ]; then
    echo "golangci-lint failed."
    exit 1
fi

# 3. Vet checks
echo "Running go vet..."
go vet ./...
if [ $? -ne 0 ]; then
    echo "go vet found issues."
    exit 1
fi

echo "Pre-commit checks passed!"
